var botonQuitar=function(a,c){var b='<div class="quitarDetalle"><a class="link_boton_rojo" href="javascript:void(0);" alt="Quitar" id="linkQuitar_'+c+'">Quitar</a></div>';jQuery(a).find("legend > span").append(b);jQuery("#linkQuitar_"+c).bind("click",function(){if(jQuery("fieldSet.detail").length>1){jQuery("#"+jQuery(this).attr("id").replace("linkQuitar_","fieldset_")).remove();jQuery(this).remove()}else{alert("Debe dejar por lo menos un registro de detalle.")}})};var detalle=function(){var c=0;jQuery(".fieldset_multiple fieldSet.detail").each(function(){jQuery(this).attr("id","fieldset_"+c);botonQuitar(this,c);c++});var a="<img alt='Agregar' title='Agregar' src='"+jQuery.url()+"img/add.gif' />";var b=0;jQuery(".fieldset_multiple").each(function(){jQuery(this).attr("id","fieldsetMultiple_"+b);jQuery(this).append('<div class="agregarDetalle"><a class="link_boton" id="agregarDetalle_'+b+'" href="#agregarDetalle_'+b+'">Agregar</a></div>');b++})};var agregar=function(){var b=jQuery(this).attr("id").replace("agregarDetalle_","fieldsetMultiple_");var d=jQuery("#"+b+" fieldSet.detail").length;var a=jQuery("#"+b+" fieldset.detail:last").clone(true);a.attr("id","fieldset_"+d);a.find("a:first").attr("id","linkQuitar_"+d);a.find("a").each(function(){this.href=this.href.replace(/(javascript:NewCal\(\')([a-zA-Z]+)(\',\'dd\/mm\/yyyy\'\))/,"$1$2_"+d+"$3")});a.find("label.radio_label").each(function(){jQuery(this).attr("for",jQuery(this).attr("for")+"_"+d)});var c="";a.find("input, select, textarea").each(function(){if(jQuery(this).attr("name").substr(-4)=="[id]"){jQuery(this).attr("value","")}this.id=this.id+"_"+d;c=parseInt(this.name.replace(/(^data\[[a-zA-Z]+\])\[([0-9]+)\](\[[a-zA-Z_]+\])/,"$2"))+100;if(isNaN(c)){c=parseInt(this.name.replace(/(^data\[[0-9]+\]\[[a-zA-Z]+\])\[([0-9]+)\](\[[a-zA-Z_]+\])/,"$2"))+1;this.name=this.name.replace(/(^data\[[0-9]+\]\[[a-zA-Z]+\])\[([0-9]+)\](\[[a-zA-Z_]+\])/,"$1["+c+"]$3")}else{this.name=this.name.replace(/(^data\[[a-zA-Z]+\])\[([0-9]+)\](\[[a-zA-Z_]+\])/,"$1["+c+"]$3")}});jQuery("#"+b).append(a);jQuery("#"+b).append(jQuery(this).parent());if(typeof(jQuery.detailAfterAdd)=="function"){jQuery.detailAfterAdd(d,c)}};